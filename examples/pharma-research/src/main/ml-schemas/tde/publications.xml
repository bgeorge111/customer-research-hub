<template
    xmlns="http://marklogic.com/xdmp/tde">
    <context>/*:envelope</context>
    <collections>
        <collections-and>
            <collection>Publication</collection>
        </collections-and>
    </collections>
    <vars>
        <var>
            <name>prefix1</name>
            <val>"PRH:"</val>
        </var>
        <var>
            <name>uri</name>
            <val>sem:iri(xdmp:node-uri(.))</val>
        </var>
    </vars>
    <triples>
        <triple>
            <subject>
                <val>$uri</val>
                <invalid-values>reject</invalid-values>
            </subject>
            <predicate>
                <val>sem:iri($prefix1||'entityType')</val>
            </predicate>
            <object>
                <val>xs:string('publication')</val>
            </object>
        </triple>
    </triples>
    <templates>
        <template>
            <context>*:headers</context>
            <triples>
                <triple>
                    <subject>
                        <val>$uri</val>
                        <invalid-values>reject</invalid-values>
                    </subject>
                    <predicate>
                        <val>sem:iri($prefix1||'preferredName')</val>
                    </predicate>
                    <object>
                        <val>xs:string(commonFacets/*:journalPreferredName)</val>
                        <invalid-values>ignore</invalid-values>
                    </object>
                </triple>
            </triples>
        </template>
        <template>
            <context>/*:instance/*:publication/*:article/*:enrichment/*:meta/*:entities/*/*</context>
            <triples>
                <triple>
                    <subject>
                        <val>sem:iri(./@uri)</val>
                        <invalid-values>ignore</invalid-values>
                    </subject>
                    <predicate>
                        <val>sem:iri($prefix1||'wasReferredToBy')</val>
                    </predicate>
                    <object>
                        <val>$uri</val>
                        <invalid-values>reject</invalid-values>
                    </object>
                </triple>
            </triples>
        </template>
    </templates>
</template>
